pipeline {  

    agent any
  
  environment {
   	
	def dir_path = env.JOB_BASE_NAME


  }
   stages {
    
    stage('Checkout') {
      steps {
        git 'https://github.com/nileshkardile/Demo-Infra.git'
      }
    }
   
    stage('Init') {
      steps{
       
       sh '''#!/bin/bash
				# This script is used to provision aws resources using terraform.
				echo $dir_path;
				echo $JENKINS_HOME;
				export infra_home=/var/lib/jenkins/workspace/Infra_Demo-Infra-Pipeline_master
				cd $infra_home/src
				sudo /usr/bin/terraform init;
						
               '''
        
      }
    }
     stage('Plan') {
      steps{
       		sh 'cd /var/lib/jenkins/workspace/Infra_Demo-Infra-Pipeline_master/src  ; sudo /usr/bin/terraform plan'
                      
      }
    }
    
    stage('Apply') {
      steps{
       		
		sh 'cd /var/lib/jenkins/workspace/Infra_Demo-Infra-Pipeline_master/src ; sudo /usr/bin/terraform apply -auto-approve'      
      }
    }  
  }
}
